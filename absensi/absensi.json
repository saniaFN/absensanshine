{"files":[{"id":"1c24fe0c-836b-42f1-a8f5-b3d29c0d0bb6","name":"appsscript","type":"json","source":"{\n  \"timeZone\": \"Asia/Jakarta\",\n  \"dependencies\": {},\n  \"exceptionLogging\": \"STACKDRIVER\",\n  \"runtimeVersion\": \"V8\",\n  \"webapp\": {\n    \"executeAs\": \"USER_DEPLOYING\",\n    \"access\": \"ANYONE_ANONYMOUS\"\n  }\n}"},{"id":"45b75a3d-957a-4517-ba59-b53aae028d6f","name":"Kode","type":"server_js","source":"/*\n * ABSENSI - GOOGLE SCRIPT\n * ***********************************************************************************\n * Code by    : fahroni|ganteng\n * Contact me : fahroniganteng@gmail.com\n * YouTube    : https://www.youtube.com/c/FahroniGanteng\n * Github     : https://github.com/fahroniganteng\n * Date       : Jul 2021\n * License    : MIT\n */\n\n\n// SET VARIABLE \n// Silakan diganti variable dibawah ini menyesuaikan kebutuhan\n// --------------------------------------------------------------------------------------------------------------------\nvar idGambarLogo    \u003d \u00271jS5P4o06wxP7eix4By8x3R2HOGkYFA2F\u0027; // id file logo di google drive\nvar idDataPegawai   \u003d \u00271YnWYrHyThhUdmJBXR7p7qrWTVUa2XvQpS_43ccPMlEY\u0027; // id file spreadsheet\nvar idFolderAbsensi \u003d \u00271FF_IzSCzLv70-SVBMWP7FsRRDgSuC67y\u0027; // id folder absensi\nvar namaPerusahaan  \u003d \u0027sanshine.co\u0027;\n\n// koordinat [lat,lon] --\u003e koordinat bisa diambil dari google map (cek video di channel youtube saya)\nvar lokasiPerusahaan \u003d [-3.607140, 98.719311]; \n\n// max jarak (dari koordinat perusahaan) yang diperbolehkan absensi dari kantor (dalam km)\n// jika perlu dalam meter isikan dalam koma, misal 100m isikan 0.1\nvar jarakMaxWFO \u003d 3;\n\n// max jarak absen dari rumah dalam km (bisa menggunakan koma juga)\nvar jarakMaxWFH \u003d 100;\n\n// Perhitungan potongan terlambat dan pulang awal\nvar jamMasuk    \u003d \u002707:30:00\u0027;\nvar jamPulang   \u003d \u002717:00:00\u0027;\n\n// potongan jika tidak absen masuk atau pulang (dalam jam)\n// dan digunakan sebagai maximal jumlah potongan\n// misal :\n//    tidakAbsen  \u003d 4;\n//    jamMasuk    \u003d \u002707:30:00\u0027;\n//    kemudian pegawai absen masuk jam 14:30:00 \n//    maka, keterlambatan sebenarnya \u003d 7 jam, namun untuk potongan keterlambatan akan dihitung 4 jam\nvar tidakAbsen  \u003d 4; \n\n\n/*\n * GET TIME ZONE \n * manual         : https://developers.google.com/apps-script/reference/utilities/utilities#formatDate(Date,String,String)\n * manual format  : https://docs.oracle.com/javase/7/docs/api/java/text/SimpleDateFormat.html\n * valid code     : \n *    var timeZone \u003d \u0027GMT+07:00\u0027; \n *    var timeZone \u003d \u0027GMT+07\u0027;\n *    var timeZone \u003d \u0027GMT+7\u0027;\n * */\n var timeZone \u003d \u0027GMT+07:00\u0027; \n\n /*\n * GET TIME ZONE CITY\n * manual     : https://developers.google.com/apps-script/reference/spreadsheet/spreadsheet#setSpreadsheetTimeZone(String)\n * list city  : http://joda-time.sourceforge.net/timezones.html\n * valid code : \n *    var timeZoneCity \u003d \u0027Asia/Jakarta\u0027; \n * */\nvar timeZoneCity \u003d \u0027Asia/Jakarta\u0027; \n\n/*\n * GET LOCALE \n * manual       : https://developers.google.com/apps-script/reference/spreadsheet/spreadsheet#setspreadsheetlocalelocale\n * list locale  : https://wpastra.com/docs/complete-list-wordpress-locale-codes/\n * valid code   :\n *    var localeCode \u003d \u0027id_ID\u0027;\n *    var localeCode \u003d \u0027id\u0027;\n * */\nvar localeCode \u003d \u0027id\u0027;\n\n\n// CLI firebase deploy manual:\n// https://firebase.google.com/docs/hosting/?authuser\u003d0#implementation_path\n\n// END SET VARIABLE \n// --------------------------------------------------------------------------------------------------------------------\n\n\n\n\n\n\n// Class untuk proses absensi\n// --------------------------------------------------------------------------------------------------------------------\nclass absensi {\n\tconstructor(dt) { // Fungsi yang di run pertama kali pada saat class dipanggil\n\t\tthis.dt \u003d dt;\n\n\t\t// validasi data dari http web (http request)\n\t\tthis.dt.idPegawai \u003d this.dt[\u0027idPegawai\u0027]  !\u003d\u003d undefined ? this.dt.idPegawai.toString() : \u0027\u0027;\n\t\tthis.dt.password  \u003d this.dt[\u0027password\u0027]   !\u003d\u003d undefined ? this.dt.password.toString() : \u0027\u0027;\n\t\tthis.dt.kegiatan  \u003d this.dt[\u0027kegiatan\u0027]   !\u003d\u003d undefined ? this.dt.kegiatan.toString() : \u0027\u0027;\n\t\tthis.dt.absensi   \u003d this.dt[\u0027absensi\u0027]    !\u003d\u003d undefined ? this.dt.absensi.toString() : \u0027\u0027;\n\t\tthis.dt.workFrom  \u003d this.dt[\u0027workFrom\u0027]   !\u003d\u003d undefined ? this.dt.workFrom.toString() : \u0027\u0027;\n\t\tthis.dt.position  \u003d this.dt[\u0027position\u0027]   !\u003d\u003d undefined ? this.dt.position : [0, 0];\n\t\tthis.dt.kegiatan  \u003d this.dt[\u0027kegiatan\u0027]   !\u003d\u003d undefined ? this.dt.kegiatan.toString() : \u0027\u0027;\n\n\t\t// get list data pegawai --\u003e from spreadsheet\n\t\tthis.indexUser \u003d -1;\n\t\tlet user \u003d SpreadsheetApp.openById(idDataPegawai);\n\t\tlet userSheet \u003d user.getSheetByName(\u0027Pegawai\u0027);//sheet\n\t\tthis.user \u003d userSheet.getRange(2, 1, userSheet.getRange(\"A1\").getDataRegion().getLastRow() - 1, 10).getValues();\n\t}\n\n  // Cek file spreadsheet (file : Data Absensi/yyyy-mm) di bulan terkait sudah ada atau belum\n  getSpreatsheetDataAbsensi(now){\n    let spreadsheetName   \u003d Utilities.formatDate(now, timeZone, \"yyyy-MM\");\n    let sheetName         \u003d \u0027Absensi Pegawai\u0027;\n    let dir               \u003d DriveApp.getFolderById(idFolderAbsensi);\n    let fileName          \u003d dir.getFilesByName(spreadsheetName);\n    let dataAbsensi;      // variable buat file spreadsheet\n    let shDataAbsensi;    // variable buat sheet\n\n    // buat file spreadsheet jika belum ada\n    if(!fileName.hasNext()){\n      dataAbsensi   \u003d SpreadsheetApp.create(spreadsheetName); // create file spreadsheet\n      dataAbsensi.setSpreadsheetTimeZone(timeZoneCity);       // set timezone spreadsheet\n      dataAbsensi.setSpreadsheetLocale(localeCode);           // set locale (lokasi) spreadsheet\n      dataAbsensi.renameActiveSheet(sheetName);               // rename sheet --\u003e \u0027Absensi Pegawai\u0027\n      DriveApp.getFileById(dataAbsensi.getId()).moveTo(dir);  // move to folder (create file spreadsheet berada di root google drive)\n      shDataAbsensi \u003d dataAbsensi.getSheetByName(sheetName);  // open sheet \u0027Absensi Pegawai\u0027\n      \n      // Bikin header table di baris pertama \u0026 format text nya\n      shDataAbsensi.getRange(\u0027A1:O1\u0027)\n        .setValues([[ \u0027TGL\u0027,\u0027ID\u0027,\u0027NAMA\u0027,\u0027BAGIAN\u0027,\u0027JAM MASUK\u0027,\u0027POTONGAN MASUK\u0027,\u0027STATUS MASUK\u0027,\u0027JARAK MASUK\u0027,\n                      \u0027LOKASI MASUK\u0027,\u0027JAM PULANG\u0027,\u0027POTONGAN PULANG\u0027,\u0027STATUS PULANG\u0027,\u0027JARAK PULANG\u0027,\n                      \u0027LOKASI PULANG\u0027,\u0027KEGIATAN\u0027]])\n        .setHorizontalAlignment(\u0027center\u0027)\n        .setVerticalAlignment(\u0027middle\u0027)\n        .setWrap(true)\n        .setBackground(\u0027#000000\u0027)\n        .setFontColor(\u0027#FFFFFF\u0027)\n        .setFontFamily(\u0027Comfortaa\u0027)\n      ;\n      shDataAbsensi.getRange(\u0027E1:I1\u0027).setBackground(\u0027#274E13\u0027);\n      shDataAbsensi.getRange(\u0027J1:N1\u0027).setBackground(\u0027#660000\u0027);\n      shDataAbsensi.getRange(\u0027O:O\u0027).setWrap(true);\n      // new row not formatted --\u003e pindah tiap input data baru\n      // shDataAbsensi.getRange(\u0027E:E\u0027).setNumberFormat(\u0027H:mm:ss\u0027);\n      // shDataAbsensi.getRange(\u0027J:J\u0027).setNumberFormat(\u0027H:mm:ss\u0027);\n\n      //set lebar kolom\n      shDataAbsensi.setColumnWidth(9,150);\n      shDataAbsensi.setColumnWidth(14,150);\n      shDataAbsensi.setColumnWidth(15,300);\n    }\n\n    // buka file spreadsheet jika sudah ada\n    else{ \n      dataAbsensi \u003d SpreadsheetApp.open(fileName.next());\n      shDataAbsensi \u003d dataAbsensi.getSheetByName(sheetName);\n    }\n    \n    return shDataAbsensi;\n  }\n\n  // Cek data absensi, apakah hari ini user sudah absen?\n  getUserAbsen(shDataAbsensi,dateNow){\n    let user            \u003d this.user[this.indexUser];\n    let jmlDataAbsensi  \u003d shDataAbsensi.getRange(\"A1\").getDataRegion().getLastRow() - 1;\n    let indexAbsensi    \u003d -1;//belum ada data absensi di hari yang sama \u003d -1\n    if(jmlDataAbsensi\u003e0){\n      let dataAbsensi     \u003d shDataAbsensi.getRange(2, 1, jmlDataAbsensi, 2).getValues();\n      for (let i\u003d0; i\u003cdataAbsensi.length;i++) {\n        let dateDataAbsensi \u003d Utilities.formatDate(dataAbsensi[i][0], timeZone, \u0027yyyy-MM-dd\u0027);\n        // cek id user di hari yang sama\n        if(dataAbsensi[i][1]+dateDataAbsensi \u003d\u003d user[1]+dateNow) {\n          indexAbsensi \u003d i;\n          break;\n        }\n      }\n    }\n    return indexAbsensi;\n  }\n\n  // hitung potongan terlambat masuk, dalam jam\n  potonganMasuk(now){\n    let dateNow       \u003d Utilities.formatDate(now, timeZone, \u0027yyyy-MM-dd\u0027);\n    let jamMasukToday \u003d new Date(dateNow+\u0027T\u0027+jamMasuk);\n    let telat         \u003d now.getTime() - jamMasukToday.getTime(); // dalam mili second\n    telat \u003d Math.ceil(telat/(1000*60*60));      // convert ke jam (pembulatan keatas)\n    telat \u003d telat\u003c0?0:telat;                    // jika nilai minus, absen lebih awal --\u003e telat \u003d 0\n    telat \u003d telat\u003etidakAbsen?tidakAbsen:telat;  // jika melebiji nilai tidakAbsen\n    return telat;\n  }\n\n  // hitung potongan pulang lebih awal, dalam jam\n  potonganPulang(now){\n    let dateNow         \u003d Utilities.formatDate(now, timeZone, \u0027yyyy-MM-dd\u0027);\n    let jamPulangToday  \u003d new Date(dateNow+\u0027T\u0027+jamPulang);\n    let pulangAwal      \u003d jamPulangToday.getTime() - now.getTime(); // dalam mili second\n    pulangAwal  \u003d Math.ceil(pulangAwal/(1000*60*60));     // convert ke jam (pembulatan keatas)\n    pulangAwal  \u003d pulangAwal\u003c0?0:pulangAwal;\n    pulangAwal  \u003d pulangAwal\u003etidakAbsen?tidakAbsen:pulangAwal;\n    return pulangAwal;\n  }\n\n\tsaveAbsensi() {\n    let now       \u003d new Date();\n    let dateNow   \u003d Utilities.formatDate(now, timeZone, \u0027yyyy-MM-dd\u0027);\n    //let timeNow   \u003d Utilities.formatDate(now, timeZone, \u0027HH:mm:ss\u0027); --\u003e format jam tanpa tanggal, di read dari script berubah timezone\n    let timeNow   \u003d Utilities.formatDate(now, timeZone, \u0027yyyy-MM-dd HH:mm:ss\u0027);\n    \n    // buka atau bikin spreadsheet absensi bulanan --\u003e tak taruh di fungsi sendiri biar mudah dimengerti \u0026 dibaca\n    let shDataAbsensi   \u003d this.getSpreatsheetDataAbsensi(now);\n\n    // cek user sudah absen atau belum --\u003e tak taruh di fungsi sendiri biar mudah dimengerti \u0026 dibaca\n    let indexAbsensi    \u003d this.getUserAbsen(shDataAbsensi,dateNow);\n\n    let ret             \u003d {success : false, msg : \u0027\u0027};  // format untuk return\n    let user            \u003d this.user[this.indexUser];    // get data user yang absen (fungsi di constructor)\n    let masuk           \u003d this.dt.absensi\u003d\u003d\u0027Masuk\u0027;     // masuk \u003d true; pulang \u003d false\n    let koordinat       \u003d this.dt.position[0] + \u0027,\u0027 + this.dt.position[1];\n    let potonganMasuk   \u003d this.potonganMasuk(now);      // get potongan terlambat (tak taruh di fungsi sendiri juga)\n    let potonganPulang  \u003d this.potonganPulang(now);     // get potongan pulang lebih awal (tak taruh di fungsi sendiri juga)\n\n    // // get alamat dari koordinat --\u003e gak jadi pakai, text terlalu panjang di laporan (spreadsheet)\n    // let location \u003d Maps.newGeocoder().reverseGeocode(this.dt.position[0], this.dt.position[1]); \n\n    // user belum ada data absensi di hari yang sama (indexAbsensi\u003d -1) --\u003e sisipkan baris baru (paling bawah)\n    if(indexAbsensi\u003c0){ \n      shDataAbsensi.appendRow([\n        dateNow,                          // 1. \u0027TGL\u0027\n        user[1],                          // 2. \u0027ID\u0027\n        user[2],                          // 3. \u0027NAMA\u0027\n        user[3],                          // 4. \u0027BAGIAN\u0027\n        masuk?timeNow:null,               // 5. \u0027JAM MASUK\u0027\n        masuk?potonganMasuk:tidakAbsen,   // 6. \u0027POTONGAN MASUK\u0027\n        masuk?this.dt[\u0027workFrom\u0027]:null,   // 7. \u0027STATUS MASUK\u0027\n        masuk?this.distance:null,         // 8. \u0027JARAK MASUK\u0027\n        masuk?koordinat:null,             // 9. \u0027LOKASI MASUK\u0027\n        !masuk?timeNow:null,              // 10. \u0027JAM PULANG\u0027\n        !masuk?potonganPulang:tidakAbsen, // 11. \u0027POTONGAN PULANG\u0027\n        !masuk?this.dt[\u0027workFrom\u0027]:null,  // 12.\u0027STATUS PULANG\u0027\n        !masuk?this.distance:null,        // 13.\u0027JARAK PULANG\u0027\n        !masuk?koordinat:null,            // 14.\u0027LOKASI PULANG\u0027\n        this.dt[\u0027kegiatan\u0027],              // 15.\u0027KEGIATAN\u0027\n      ]);\n      \n\n      ret.success \u003d true;\n      ret.msg     \u003d user[2];\n    }\n\n    // user sudah ada data absensi di hari yang sama --\u003e update data\n    else{\n      // index dimulai dari 0 dan baris dimulai dari 1 --\u003e baris 1 (paling atas) dipakai header table \n      // jadi data absensi index 0 \u003d baris 2\n      indexAbsensi    \u003d indexAbsensi + 2; \n\n      let absenMasuk  \u003d shDataAbsensi.getRange(indexAbsensi,5).getValue();\n\n      // larangan absen masuk lebih dari sekali dalam sehari\n      if(masuk \u0026\u0026 absenMasuk!\u003d\u0027\u0027)\n        ret.msg \u003d \u0027Anda sudah melakukan absensi masuk jam \u0027+Utilities.formatDate(absenMasuk, timeZone, \u0027HH:mm:ss\u0027);\n\n      // absen masuk lagi (jika salah absen pulang duluan)\n      else if(masuk){\n        shDataAbsensi.getRange(indexAbsensi,5,1,5).setValues([[\n          timeNow,             // 5. \u0027JAM MASUK\u0027\n          potonganMasuk,       // 6. \u0027POTONGAN MASUK\u0027\n          this.dt[\u0027workFrom\u0027], // 7. \u0027STATUS MASUK\u0027\n          this.distance,       // 8. \u0027JARAK MASUK\u0027\n          koordinat,           // 9. \u0027LOKASI MASUK\u0027\n        ]]);\n        ret.success \u003d true;\n        ret.msg     \u003d user[2];\n      }\n\n      // absen pulang\n      else{\n        shDataAbsensi.getRange(indexAbsensi,10,1,6).setValues([[\n          timeNow,              // 10. \u0027JAM PULANG\u0027\n          potonganPulang,       // 11. \u0027POTONGAN PULANG\u0027\n          this.dt[\u0027workFrom\u0027],  // 12. \u0027STATUS PULANG\u0027\n          this.distance,        // 13. \u0027JARAK PULANG\u0027\n          koordinat,            // 14. \u0027LOKASI PULANG\u0027\n          this.dt[\u0027kegiatan\u0027],  // 15. \u0027KEGIATAN\u0027\n        ]]);\n        ret.success \u003d true;\n        ret.msg     \u003d user[2];\n      }\n    }\n\n    // format jam masuk \u0026 pulang \n    // (jika cell kosong pidah format otomatis, jadi tiap ada data baru harus format lagi)\n    shDataAbsensi.getRange(\u0027E:E\u0027).setNumberFormat(\u0027H:mm:ss\u0027);\n    shDataAbsensi.getRange(\u0027J:J\u0027).setNumberFormat(\u0027H:mm:ss\u0027);\n    \n    return ret;\n\t}\n\n  // cek login user ID \u0026 password\n\tvalidUser() {\n\t\tlet id \u003d this.user.map(function (r) { return r[1].toString().toUpperCase(); });\n\t\tlet pass \u003d this.user.map(function (r) { return r[4].toString(); });\n\t\tthis.indexUser \u003d id.indexOf(this.dt.idPegawai.toUpperCase());\n\t\treturn (this.indexUser \u003e\u003d 0 \u0026\u0026 pass[this.indexUser] \u003d\u003d this.dt.password) ? true : false;\n\t}\n\n  // cek jarak dari perusahaan \n\tvalidDistance() {\n    // sesuaikan dengan list Lokasi \u0026 status absensi di index.html\n    let bolehAbsenDariRumah \u003d [\u0027WFH\u0027,\u0027Ijin\u0027]; \n\n\t\tif (this.dt.position[0] \u003d\u003d 0 \u0026\u0026 this.dt.position[1] \u003d\u003d 0)\n\t\t\treturn \u0027Lokasi anda tidak terekam...\u0027;\n\t\telse {\n      // get jarak kantor dengan lokasi absen\n\t\t\tthis.distance \u003d this.getDistanceBetween(lokasiPerusahaan[0], lokasiPerusahaan[1], this.dt.position[0], this.dt.position[1]);\n\n      // pilih lokasi absen kantor dan jarak \u003e jarakMaxWFO\n\t\t\tif (this.distance \u003e jarakMaxWFO \u0026\u0026 !bolehAbsenDariRumah.includes(this.dt.workFrom))\n\t\t\t\treturn \u0027Lokasi anda terlalu jauh\u003cbr\u003e\u003ca href\u003d\"https://www.google.com/maps/dir/?api\u003d1\u0027 + \n          \u0027\u0026origin\u003d\u0027 + this.dt.position[0] + \u0027,\u0027 + this.dt.position[1] +\n          \u0027\u0026destination\u003d\u0027 + lokasiPerusahaan[0] + \u0027,\u0027 + lokasiPerusahaan[1] +\n          \u0027\u0026travelmode\u003dwalking\" \u0027+\n          \u0027target\u003d\"_blank\"\u003e\u0027 + \n          this.distance + \u0027km dari perusahaan\u003c/a\u003e\u003cbr\u003e\u0027 +\n          \u0027Maksimal jarak untuk \u0027+ this.dt.workFrom +\u0027 adalah \u0027 + jarakMaxWFO + \u0027km.\u0027;\n      \n      // pilih lokasi rumah dan jarak \u003e jarakMaxWFH\n\t\t\telse if (this.distance \u003e jarakMaxWFH \u0026\u0026 bolehAbsenDariRumah.includes(this.dt.workFrom))\n        return \u0027Lokasi anda terlalu jauh\u003cbr\u003e\u003ca href\u003d\"https://www.google.com/maps/dir/?api\u003d1\u0027 + \n          \u0027\u0026origin\u003d\u0027 + this.dt.position[0] + \u0027,\u0027 + this.dt.position[1] +\n          \u0027\u0026destination\u003d\u0027 + lokasiPerusahaan[0] + \u0027,\u0027 + lokasiPerusahaan[1] +\n          \u0027\u0026travelmode\u003dwalking\" \u0027+\n          \u0027target\u003d\"_blank\"\u003e\u0027 + \n          this.distance + \u0027km dari perusahaan\u003c/a\u003e\u003cbr\u003e\u0027 +\n          \u0027Maksimal jarak untuk \u0027+ this.dt.workFrom +\u0027 adalah \u0027 + jarakMaxWFH + \u0027km.\u0027;\n\t\t\t\n      // jarak valid\n      else return \u0027confirm\u0027;\n\t\t}\n\t}\n\tgetDistanceBetween(originLat, originLong, destLat, destLong) {\n\t\tvar directions, route;\n\n\t\t// Create a new Direction finder using Maps API available on Google Apps Script\n\t\tdirections \u003d Maps.newDirectionFinder()\n\t\t\t.setOrigin(originLat, originLong)\n\t\t\t.setDestination(destLat, destLong)\n\t\t\t.setMode(Maps.DirectionFinder.Mode.WALKING)\n\t\t\t.getDirections(); // Direction Object\n\n\t\t// The path may have some segments so it sum it all\n\t\tif (directions.routes[0]) {\n\t\t\troute \u003d directions.routes[0].legs.reduce(function (acc, currentRow) {\n\t\t\t\tacc.dist +\u003d currentRow.distance.value / 1000;\n\t\t\t\tacc.dur +\u003d currentRow.duration.value / 60;\n\t\t\t\treturn acc;\n\t\t\t}, { dist: 0, dur: 0 });\n\t\t\treturn route.dist;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n}\n// END Class proses absensi\n// --------------------------------------------------------------------------------------------------------------------\n\n\n\n// jika web diakses/dibuka, yang pertama kali dijalankan adalah fungsi ini \n// --------------------------------------------------------------------------------------------------------------------\nfunction doGet() { \n\tlet templateIndex \u003d HtmlService.createTemplateFromFile(\u0027index\u0027);  // baca index.html\n\ttemplateIndex.dt \u003d {  // kirim variable ke index.html\n\t\tlogo: getImage(idGambarLogo),\n\t\tperusahaan: namaPerusahaan\n\t};\n\treturn templateIndex\n\t\t.evaluate()\n\t\t.setSandboxMode(HtmlService.SandboxMode.IFRAME)\n\t\t.addMetaTag(\u0027viewport\u0027, \u0027width\u003ddevice-width, initial-scale\u003d1\u0027)  // biar auto scale jika dibuka via HP\n    .setXFrameOptionsMode(HtmlService.XFrameOptionsMode.ALLOWALL);  // allow embed --\u003e iframe (buat ilangin banner google)\n}\n\n// Fungsi buat handle request dari index.html --\u003e klik simpan absensi di web\n// --------------------------------------------------------------------------------------------------------------------\nfunction submitAbsensi(dt) {\n\tlet a   \u003d new absensi(dt);              // panggil class absensi\n\tlet ret \u003d {\tsuccess: false,\tmsg: \u0027\u0027\t};  // format return (web request)\n\n\tif (!a.validUser()) ret.msg \u003d \u0027Anda tidak terdaftar\u0027; // cek user \u0026 password ada di list daftar pegawai\n\telse{\n    let cekJarak \u003d a.validDistance();                   // get jarak lokasi absen \u0026 kantor\n    if (cekJarak !\u003d \u0027confirm\u0027) ret.msg \u003d cekJarak;      // jika tidak valid kembalikan link google map direction lokasi ke kantor\n\t  else ret \u003d a.saveAbsensi();                         // jika valid \n  }\n\treturn ret;\n}\n\n// Fungsi buat buka gambar (dipake buat buka logo.png doang)\n// --------------------------------------------------------------------------------------------------------------------\nfunction getImage(fileId) {\n\tvar img \u003d DriveApp.getFileById(fileId).getBlob().getBytes(); // get image dari drive berdasarkan id file\n\treturn Utilities.base64Encode(img); // convert image ke base64Encode\n}\n\n\n\n\n\n\n\n// Fungsi dibawah ini hanya untuk test input data absen saja --------------------------------------\nfunction testInput(){\n  let dt\u003d {\n    idPegawai : \u002720210001MT\u0027,\n\t\tpassword  : \u002720210001\u0027,\n\t\tkegiatan  : \u0027\u0027,\n\t\tabsensi   : \u0027Masuk\u0027,\n\t\tworkFrom  : \u0027WFH\u0027,\n\t\tposition  : [-6.089501, 106.997263],\n    kegiatan  : \u0027test\u0027,\n  }\n  let a \u003d new absensi(dt);\n  if (!a.validUser()) Logger.log(\u0027Anda tidak terdaftar\u0027);\n\telse {\n\t\tlet cekJarak \u003d a.validDistance();\n\t\tif (cekJarak !\u003d \u0027confirm\u0027) Logger.log(cekJarak);\n\t\telse {\n\t\t\tLogger.log(a.saveAbsensi());\n\t\t}\n\t}\n}\n\n\n"},{"id":"85a6732c-768e-43f2-ba02-95ae90be24ba","name":"index","type":"html","source":"\u003c!--\n * ABSENSI - GOOGLE SCRIPT\n * ***********************************************************************************\n * Code by    : fahroni|ganteng\n * Contact me : fahroniganteng@gmail.com\n * YouTube    : https://www.youtube.com/c/FahroniGanteng\n * Github     : https://github.com/fahroniganteng\n * Date       : Jul 2021\n * License    : MIT\n--\u003e\n\u003c!DOCTYPE html\u003e\n\u003chtml\u003e\n\n\u003chead\u003e\n\t\u003cbase target\u003d\"_top\"\u003e\n\t\u003cmeta name\u003d\"viewport\" content\u003d\"width\u003ddevice-width, initial-scale\u003d1\"\u003e\n   \u003clink rel\u003d\"stylesheet\" href\u003d\"https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.6.0/css/bootstrap.min.css\" /\u003e\n   \u003clink rel\u003d\"stylesheet\" href\u003d\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css\"/\u003e\n\u003c/head\u003e\n\n\u003cbody class\u003d\"bg-light\"\u003e\n\t\u003cdiv class\u003d\"container\"\u003e\n\t\t\u003cdiv class\u003d\"py-5 text-center\"\u003e\n\t\t\t\u003cimg class\u003d\"d-block mx-auto mb-4\" src\u003d\"1jS5P4o06wxP7eix4By8x3R2HOGkYFA2F\" alt\u003d\"\" width\u003d\"200\"\u003e\n\t\t\t\u003ch2\u003e\n\t\t\t\t\u003c?!\u003ddt.perusahaan?\u003e\n\t\t\t\u003c/h2\u003e\n\n\n      \u003c!-- SILAKAN HAPUS BAGIAN INI UNTUK MENGHILANGKAN INFO APLIKASI ------------------------------------------------\u003e\n      \u003cp\u003e\n        \u003cb\u003eDemo Aplikasi Web Absensi v.03\u003c/b\u003e\u003cbr\u003e\n        \u003ca href\u003d\"https://www.youtube.com/c/FahroniGanteng\" target\u003d\"_blank\" class\u003d\"mr-2\"\u003e\n          \u003ci class\u003d\"fab fa-youtube mr-2 text-danger\"\u003e\u003c/i\u003eYouTube Channel\n        \u003c/a\u003e | \n        \u003ca href\u003d\"https://github.com/fahroniganteng\" target\u003d\"_blank\" class\u003d\"ml-2\"\u003e\n          \u003ci class\u003d\"fab fa-github mr-2 text-muted\"\u003e\u003c/i\u003eFork me at Github\n        \u003c/a\u003e\n      \u003c/p\u003e\n      \u003c!-- AKHIR HAPUS INFO -------------------------------------------------------------------------------------------\u003e\n\t\t\n    \n    \u003c/div\u003e\n\t\t\u003cform class\u003d\"row\" onsubmit\u003d\"submitAbsensi();return false;\"\u003e\n\t\t\t\u003cdiv class\u003d\"col-md-12\"\u003e\n\t\t\t\t\u003ch4 class\u003d\"mb-3\"\u003eFormulir Absensi\u003c/h4\u003e\n\t\t\t\t\u003cdiv class\u003d\"mb-3\"\u003e\n\t\t\t\t\t\u003clabel for\u003d\"idPegawai\"\u003eID Pegawai\u003c/label\u003e\n\t\t\t\t\t\u003cinput type\u003d\"text\" class\u003d\"form-control\" id\u003d\"idPegawai\" placeholder\u003d\"Masukkan ID Anda\" required\u003e\n\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003cdiv class\u003d\"mb-3\"\u003e\n\t\t\t\t\t\u003clabel for\u003d\"password\"\u003ePassword\u003c/label\u003e\n\t\t\t\t\t\u003cinput type\u003d\"password\" class\u003d\"form-control\" id\u003d\"password\" placeholder\u003d\"Masukkan password anda\" required\u003e\n\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003cdiv class\u003d\"mb-3\"\u003e\n\t\t\t\t\t\u003clabel\u003eAbsensi\u003c/label\u003e\n\t\t\t\t\t\u003cdiv class\u003d\"form-check\"\u003e\n\t\t\t\t\t\t\u003cinput class\u003d\"form-check-input\" type\u003d\"radio\" name\u003d\"absensi\" id\u003d\"absensi1\" value\u003d\"Masuk\" required\u003e\n\t\t\t\t\t\t\u003clabel class\u003d\"form-check-label\" for\u003d\"absensi1\"\u003eMasuk\u003c/label\u003e\n\t\t\t\t\t\u003c/div\u003e\n\t\t\t\t\t\u003cdiv class\u003d\"form-check\"\u003e\n\t\t\t\t\t\t\u003cinput class\u003d\"form-check-input\" type\u003d\"radio\" name\u003d\"absensi\" id\u003d\"absensi2\" value\u003d\"Pulang\"\u003e\n\t\t\t\t\t\t\u003clabel class\u003d\"form-check-label\" for\u003d\"absensi2\"\u003ePulang\u003c/label\u003e\n\t\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003cdiv class\u003d\"mb-3\"\u003e\n\t\t\t\t\t\u003clabel\u003eLokasi \u0026 Status Absensi\u003c/label\u003e\n          \u003c!--\n            Jika menambah list Lokasi \u0026 status absensi, sesuaikan juga pada kode.gs fungsi validDistance()\n          --\u003e\n\t\t\t\t\t\u003cdiv class\u003d\"form-check\"\u003e\n\t\t\t\t\t\t\u003cinput class\u003d\"form-check-input\" type\u003d\"radio\" name\u003d\"workFrom\" id\u003d\"workFrom2\" value\u003d\"WFO\" required\u003e\n\t\t\t\t\t\t\u003clabel class\u003d\"form-check-label\" for\u003d\"workFrom2\"\u003eKantor - WFO sesuai jadwal\u003c/label\u003e\n\t\t\t\t\t\u003c/div\u003e\n\t\t\t\t\t\u003cdiv class\u003d\"form-check\"\u003e\n\t\t\t\t\t\t\u003cinput class\u003d\"form-check-input\" type\u003d\"radio\" name\u003d\"workFrom\" id\u003d\"workFrom3\" value\u003d\"On Call\"\u003e\n\t\t\t\t\t\t\u003clabel class\u003d\"form-check-label\" for\u003d\"workFrom3\"\u003eKantor - On call\u003c/label\u003e\n\t\t\t\t\t\u003c/div\u003e\n\t\t\t\t\t\u003cdiv class\u003d\"form-check\"\u003e\n\t\t\t\t\t\t\u003cinput class\u003d\"form-check-input\" type\u003d\"radio\" name\u003d\"workFrom\" id\u003d\"workFrom4\" value\u003d\"Piket\"\u003e\n\t\t\t\t\t\t\u003clabel class\u003d\"form-check-label\" for\u003d\"workFrom4\"\u003eKantor - Piket\u003c/label\u003e\n\t\t\t\t\t\u003c/div\u003e\n          \u003cdiv class\u003d\"form-check\"\u003e\n\t\t\t\t\t\t\u003cinput class\u003d\"form-check-input\" type\u003d\"radio\" name\u003d\"workFrom\" id\u003d\"workFrom1\" value\u003d\"WFH\"\u003e\n\t\t\t\t\t\t\u003clabel class\u003d\"form-check-label\" for\u003d\"workFrom1\"\u003eRumah - WFH sesuai jadwal\u003c/label\u003e\n\t\t\t\t\t\u003c/div\u003e\n          \u003cdiv class\u003d\"form-check\"\u003e\n\t\t\t\t\t\t\u003cinput class\u003d\"form-check-input\" type\u003d\"radio\" name\u003d\"workFrom\" id\u003d\"workFrom5\" value\u003d\"Ijin\"\u003e\n\t\t\t\t\t\t\u003clabel class\u003d\"form-check-label\" for\u003d\"workFrom5\"\u003eRumah - Ijin\u003c/label\u003e\n\t\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003cdiv class\u003d\"mb-3\"\u003e\n\t\t\t\t\t\u003clabel for\u003d\"kegiatan\"\u003eKegiatan Harian\u003c/label\u003e\n\t\t\t\t\t\u003ctextarea class\u003d\"form-control\" id\u003d\"kegiatan\" placeholder\u003d\"Diisi hanya saat pulang\" rows\u003d\"4\"\u003e\u003c/textarea\u003e\n\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003chr class\u003d\"mb-4\"\u003e\n\t\t\t\t\u003cdiv class\u003d\"alert alert-success\" role\u003d\"alert\" style\u003d\"display:none\"\u003e\u003c/div\u003e\n\t\t\t\t\u003cdiv class\u003d\"alert alert-warning\" role\u003d\"alert\" style\u003d\"display:none\"\u003e\n\t\t\t\t\t\u003ch5\u003ePerhatian!\u003c/h5\u003e\n\t\t\t\t\t\u003cp\u003eAnda harus mengijinkan akses lokasi pada browser agar bisa melakukan absensi\u003c/p\u003e\n\t\t\t\t\u003c/div\u003e\n\t\t\t\t\u003cbutton class\u003d\"btn btn-primary btn-lg btn-block\" type\u003d\"submit\"\u003e\u003ci class\u003d\"fas fa-fingerprint mr-2\"\u003e\u003c/i\u003e Simpan Absensi\u003c/button\u003e\n\t\t\t\u003c/div\u003e\n\t\t\u003c/form\u003e\n\t\t\u003cfooter class\u003d\"my-5 pt-5 text-muted text-center text-small\"\u003e\n\t\t\t\u003cp class\u003d\"mb-1\"\u003e\n        Copyright \u0026copy; 2021 \u003c?!\u003ddt.perusahaan?\u003e. All rights reserved\n\t\t\t\u003c/p\u003e\n\t\t\u003c/footer\u003e\n\t\u003c/div\u003e\n\n\t\u003cscript src\u003d\"https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js\"\u003e\u003c/script\u003e\n\t\u003cscript src\u003d\"https://cdnjs.cloudflare.com/ajax/libs/limonte-sweetalert2/11.0.18/sweetalert2.all.min.js\"\u003e\u003c/script\u003e\n\t\u003cscript\u003e\n\t\tfunction loading(){\n      $(\u0027.btn\u0027).attr(\u0027disabled\u0027, true).html(\u0027\u003ci class\u003d\"fas fa-spinner fa-pulse mr-2\"\u003e\u003c/i\u003e Menyimpan...\u0027);\n    }\n    function unloading(){\n      $(\u0027.btn\u0027).removeAttr(\u0027disabled\u0027).html(\u0027\u003ci class\u003d\"fas fa-fingerprint mr-2\"\u003e\u003c/i\u003e Simpan Absensi\u0027);\n    }\n\n\t\tfunction submitAbsensi() {\n      loading();\n\t\t\tif (navigator.geolocation){\n        $(\u0027.alert-warning\u0027).show();\n        navigator.geolocation.getCurrentPosition(simpanDataAbsensi, errorGetLocation);\n      }\n\t\t}\n    function errorGetLocation(){\n      $(\u0027.alert-warning\u0027).show();\n      Swal.fire({\n        title: \u0027Absensi gagal!\u0027,\n        text: \u0027Anda tidak mengizinkan akses lokasi.\u0027,\n        icon: \u0027error\u0027,\n        confirmButtonText: \u0027OK\u0027\n      })\n      unloading();\n    }\n\t\tfunction simpanDataAbsensi(position) {\n      $(\u0027.alert-warning\u0027).hide();\n\t\t\tlet data \u003d {\n\t\t\t\tidPegawai: $(\u0027#idPegawai\u0027).val(),\n\t\t\t\tpassword: $(\u0027#password\u0027).val(),\n\t\t\t\tkegiatan: $(\u0027#kegiatan\u0027).val(),\n\t\t\t\tabsensi: $(\u0027input[name\u003dabsensi]:checked\u0027, \u0027form\u0027).val(),\n\t\t\t\tworkFrom: $(\u0027input[name\u003dworkFrom]:checked\u0027, \u0027form\u0027).val(),\n\t\t\t\tposition: [\n\t\t\t\t\tposition.coords.latitude,\n\t\t\t\t\tposition.coords.longitude\n\t\t\t\t]\n\t\t\t};\n\t\t\t// console.log(data);\n\t\t\tif (data.absensi \u003d\u003d \u0027Pulang\u0027 \u0026\u0026 data.kegiatan.length \u003c 1) {\n\t\t\t\tSwal.fire({\n\t\t\t\t\ttitle: \u0027Error!\u0027,\n\t\t\t\t\ttext: \u0027Anda belum mengisi kegiatan harian.\u0027,\n\t\t\t\t\ticon: \u0027error\u0027,\n\t\t\t\t\tconfirmButtonText: \u0027OK\u0027\n\t\t\t\t})\n        unloading();\n\t\t\t}\n\t\t\telse \n\t\t\t\tgoogle.script.run.withSuccessHandler(callbackAbsensi).submitAbsensi(data);\n\t\t}\n\t\tfunction callbackAbsensi(dt) {\n\t\t\tif (dt.success) {\n\t\t\t\tSwal.fire({\n\t\t\t\t\ttitle: \u0027Sukses!\u0027,\n\t\t\t\t\thtml: \u0027\u003cb\u003eHai, \u0027 + dt.msg + \u0027!\u003c/b\u003e\u003cbr\u003eData absensimu sudah disimpan.\u0027,\n\t\t\t\t\ticon: \u0027success\u0027,\n\t\t\t\t\tconfirmButtonText: \u0027OK\u0027\n\t\t\t\t})\n\t\t\t\t$(\u0027.form-control\u0027).val(\u0027\u0027);\n\t\t\t}\n\t\t\telse {\n\t\t\t\t$(\u0027#password\u0027).val(\u0027\u0027);\n\t\t\t\tSwal.fire({\n\t\t\t\t\ttitle: \u0027Gagal!\u0027,\n\t\t\t\t\thtml: dt.msg,\n\t\t\t\t\ticon: \u0027error\u0027,\n\t\t\t\t\tconfirmButtonText: \u0027OK\u0027\n\t\t\t\t})\n\t\t\t}\n\t\t\tunloading();\n\t\t}\n\t\u003c/script\u003e\n\u003c/body\u003e\n\u003c/html\u003e"}]}